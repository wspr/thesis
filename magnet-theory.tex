%!TEX root = thesis.tex
\chapter{Magnetic and electromagnetic forces}
\chaplabel{magnet-theory}

\epigraph{With an eye to the practical importance of levitation we
feel justified here in disregarding those aspects of it
associated with magic, spiritualism, and psychic
phenomena\dots}{\textcite{boerdijk1956b}}

\chapterprecis{
  This is the most analytical of the theory/literature sections, since it is
  here that I present and abstract a body of work that deals with `forces
  between magnets', also including some quick mentions of magnetic field
  theory and some associated concepts (such as eddy current damping).
}


\section{Magnetic fields}

It's instructive but misleading to think about magnetic fields
`squashing' as they come in proximity to each other. Just ask
\textcite{sodano2006} who received comments nitpicking comments about
their terminology \cite{marneffe2007}.

\section{Sources of the magnetic field}
\seclabel{bhm}

Magnetic fields are created by moving electrons. A long straight wire
will create cylindrical magnet fields, and a small loop will create a
magnetic dipole. Thus, an electron orbiting a proton is the smallest
magnetic element.  This is a hydrogen atom. In nature, however,
hydrogen exists as H$_2$, two protons orbited by two electrons---and
it happens that the two electrons orbit in opposite directions and the
magnetic fields of each cancel each other out.  Most material is like
this: basically, not magnetic.

The following is a very short introduction to the physics behind
magnets. A good reference book which inspired this section is
\textcite{campbell1994}.

The \define{magnetic dipole} is designated as the microscopic quantity
$\mdip = i\vect{A}$, for a current $i$ and a vector area $\vect{A}$
(direction normal to plane). For a collection of magnetic dipoles (as
in a permanent magnet), their net effect may be quantified with the
macroscopic \emph{magnetisation} of the material, $\magM$:
\begin{dmath}
  \magM =  \lim_{\Delta V \rightarrow 0} \frac{\sum \mdip}{\Delta V}.  \eqlabel{M}
\end{dmath}

The magnetisation of a permanent magnet creates the magnetic fields
that are of such great interest. \emph{Inside} the magnet (with no
other external fields present), the magnetic field, $\magB$, is given by
the simple relation
\begin{dmath}[label=BM]
  \magB = \permVac \magM
\end{dmath},
where $\permVac$ is the `permeability of the vacuum', an essentially
meaningless name given to the necessary constant of proportionality.

So, macroscopic magnetic fields have been derived from microscopic
currents. It is possible to take this full circle and now create
macroscopic current terms from the magnetic field. The equivalent
current density, $\vect{J}_m$ around a permanent magnet, created by
aligned microscopic orbiting electrons is given by:
\begin{dmath}
  \vect{J}_m = \curl\magM.
\end{dmath}
This is a good beginning for describing the effects of an \emph{external}
current density ($\vect{J}$) acting on the magnet. To separate the effects of
induced magnetisation and that caused spontaneously by magnetic material, a
new term is created: the magnetic field strength, $H$:
\begin{dmath}
  \vect{J} = \curl\magH.
\end{dmath}
Now the earlier \eqref{BM} can be adjusted to allow for both
internal and external forms of magnetisation (\ie, magnetic field
caused by permanent magnets or by current carrying conductors). This
is the fundamental equation relating the three important terms in
magnetics,
\begin{dmath}
  \magB = \permVac (\magM + \magH)  \eqlabel{BHM}
\end{dmath},
allowing the terms to be unambiguously defined. Henceforth, $\magB$ is
called the \define{magnetic flux density}, which a measure of the
total flux per area; and $\magH$ is the \define{magnetic field strength},
the effect of external current sources that creates the magnetic
field.
\note{The names of these terms are not always consistent in the
  literature. $\magM$ is also known as polarisation, and $\magB$ and $\magH$
  are both sometimes known as the magnetic field.}

Finally, the \define{permeability} $\perm$ of a material (generally
only used when the material is not a permanent magnet) is a varying
term describing the ratio between the magnitudes of the $\magB$ and $\magH$
fields. The \define{relative permeability} $\permrel$ is the ratio of
the permeability to $\permVac$.
\begin{dgroup}
  \begin{dmath}
    \perm = \frac{B}{H}
  \end{dmath},
  \begin{dmath}
    \permrel = \frac{\perm}{\permVac}
  \end{dmath}.
\end{dgroup}
\Eqref{BHM}, may now be used to describe the situation at all
points in space. Use \figref{BHM} to note that while inside the
magnet, the magnetic field is the vector sum of two components,
whereas outside the magnet, the magnetisation is zero and the magnetic
field is related to the magnetic field strength by a constant. This
results in $\magB$ being continuous everywhere, and both $\magM$~and $\magH$
being discontinuous.

\begin{figure}[htbp]
   \centering
   \grf{Figures/Theory/BHM}
   \caption{The magnetic field, $\magB$, both inside and outside a magnet.}
   \figlabel{BHM}
\end{figure}

This equivalence in air is essentially the reason that there is often
confusion between $\magB$ and $\magH$. It can be seen that within a magnet,
however, their relationship is more complex and important. The
performance of a magnet is shown by its \bhcurve/, which is shown for
an ideal magnet in \figref{BHcurve}. This curve demonstrates the
nonlinear and hysteresic effects of the magnetic flux density of a
magnetic material as external magnetic field is applied to it.

Two important features are shown in the \bhcurve/. First, the
\define{remanence} of the magnet, $B_r$. This value is equal to
$\permVac\Msat$ and occurs when there is no external
magnetic field. The other is the \define{coercive force}, $H_c$, which
is the amount of magnetic field strength required to reduce the flux
density of the magnet to zero.

\begin{figure}[htbp]
   \centering
   \grf{Figures/Theory/BHcurve}
   \caption{The characteristic $B$ \vs\ $H$ curves for an ideal rare-earth magnet.}
   \figlabel{BHcurve}
\end{figure}

When the magnet is applying energy, it is operating in the second
quadrant of its \bhcurve/, \ie, the section of the curve between the
point of remanence and the coercive force, known as the
\define{demagnetisation curve}. This is because the energy used for
the demagnetisation is being taken by the causes of the
demagnetisation. At some point in this second quadrant, $-\magB\times\magH$
will have a maximum. Since this is proportional to the energy
potential, this is known as the \define{maximum energy product}
$\BHmax$, and can be shown to be equal in an ideal magnet to:
\begin{dmath}
  -\BHmax = \frac{\Msat}{2}
\end{dmath}
The potential energy of the magnet is thus directly related to its
magnetisation.

The constitutive relation for rare earth magnets, assuming a
high coercivity, is given by \textcite{nagaraj1988}
\begin{dmath*}
  \magB = \permVac\magH + \magM ,
\end{dmath*}
assuming that the air approximates a vacuum (magnetically) and the
relative permeability of the magnet is unity.


\section{Properties of magnetic flux}
\seclabel{flux}

The previous section introduced $\magB$, the magnetic flux density. An
analysis of how to derive the paths of magnetic flux is a little
beyond the scope of this document, but it is important to discuss the
flux lines themselves.

`Magnetic flux' derives its name from archaic models of magnetism,
whose proponents believed in the literal flow of a magnetic fluid
called the `luminiferous æther'. Nowadays, scientists tend toward more
modern interpretations using electromagnetic fields involving quantum
theory. Nonetheless, the name sticks. Magnetic flux, $\flux$, is
therefore defined as the amount of `fluid' passing through an area:
\begin{dmath}
  \flux = \magB \cdot A
\end{dmath}
This flux is almost analogous to electric current; the only difference
being that electric current is constrained by the conductor it is
flowing through, whereas while magnetic flux is known to \emph{prefer}
areas of greater permeability, it occasionally can deviate from these
simple paths

It is more instructive for a basic understanding of how magnets behave
to look at the ways their flux lines interact. The following `magnet
design axioms' are adapted from \textcite{moskowitz1995}, whose book
covers permanent magnet design for a wide range of uses.

\begin{enumerate}
\item Flux lines follow the path of least resistance. This means that they will
travel through the shortest path possible,
through the material with the
\emph{greatest} permeability---so they will travel more readily through
magnetic or ferrous material than air, and more readily through air
(although only slightly) than diamagnetic material.

\item Flux lines travelling in the same direction repel each other. This means
flux lines will never cross.

\item Flux lines enter ferrous material at right angles.

\item Permeability of ferrous material is `used up' by flowing flux; when the
material reaches saturation, flux lines travel as easy though air as through
the saturated material.

\item Flux lines travel from North to South poles in closed loops.

\item Magnets are made up of a very large number of unit poles.
\end{enumerate}

From these axioms, one can generate incorrect, yet applicable,
theories how and why magnets attract and repel each other. For
example, two magnets in repulsion have flux lines opposing each
other. It can be imagined that the reason forces occur between them is
due to a `squashing' of the flux lines which the magnets try to
oppose---but theories like this only help visualising magnetic
behaviour, \emph{not} for explaining the reasons behind it.

\section{Magnetic materials}

There are several materials from which permanent magnets can be
made. Short attention will be placed on the cheaper, legacy magnetic
materials such as the ferrite magnets and alnico magnets due to their
poor performance. Rare-earth neodymium magnets are now quite
commonplace and rather cheap, and have much more desirable properties
than these old fashioned magnets.

\Tabref{magnets} shows some approximate ranges comparing the
properties of the various magnet types available. Clearly, rare earth
magnets are capable of much greater energy output, and their high
coercivity precludes them from losing their magnetisation through
physical impact or proximity with other magnets---unlike the older
ferrite and alnico magnets. Their only disadvantage is their low
operating temperatures that perhaps will be inconvenient using them
for biased, or hybrid, electromagnets, in which a current carrying
coil is wrapped around a permanent magnet to increase the output of
magnetic field.

\begin{table}
  \centering
  \begin{tabular}{@{} l r@{\,--\,}l r@{\,--\,}l r@{\,--\,}l @{}}
    \toprule
    & \multicolumn{6}{c}{Magnet type}\\
    \cmidrule{2-6}
    Property            & \multicolumn{2}{c}{Ferrite}
                        & \multicolumn{2}{c}{Alnico}
                        & \multicolumn{2}{c}{Neodymium}  \\
    \midrule
    Max.\ temperature (°C)    & \num{400} & \num{500} & \num{800} & \num{900} &    \num{ 80} & \num{200}  \\
    Remanence (T)             & \num{0.2} & \num{0.4} & \num{0.5} & \num{1.3} &    \num{  1} & \num{1.3}  \\
    Coercivity (\si{kA/m})    & \num{100} & \num{200} & \num{50 } & \num{160} & ~~~\num{800} & \num{900}  \\
    Max.\ energy product
               (\si{kJ/m^3})  & \num{6}   & \num{33}  & \num{10}  & \num{80}  &    \num{200} & \num{300}  \\
    \bottomrule
  \end{tabular}
  \caption[Typical values for various permanent magnets.]
  {Typical values for various permanent magnets.
   Adapted from information from \url{http://www.magtech.com.hk/}.}
  \tablabel{magnets}
\end{table}


\section{Analytical expressions for the magnetic field}

New publications on the analytic magnetic field equation for a thick coil appear to be being published at an accelerating rate \cite{danilov1971-nim,urankar1982-ietm,azzerboni1993-ietm,labinac2006-ajp,pechenkov2006-rndt,ravaud2010-emwaves}.

Magnetic field from pyramidal frustrum magnets: \cite{compter2010-ietm}


\section{Forces between magnets}

Force between single-turn circular coils \cite{babic2008-ietm,shiri2009-pier} can be used in the `filament method' \cite[also see]{akyel2009-pier}.

For fast magnetic field computation, the `fast multipole method' can
be used \cite{adedoyin2007}. But I haven't used it.

Magnetic fields can induce forces through a variety of
methods. Electromagnetic actuators often use Lorentz forces
\cite{hollis1993}.

\textcite{bassani2006}

A general technique for finding the forces between two magnets is
simple to describe. The first magnet creates a magnetic field in the
region of the second magnet; the force is calculated due to the
interaction of the first magnet's field and the internal field of the
second magnet. Or vice versa; reciprocity holds here.

The magnetic field due to a magnet can be calculated by modelling the
magnet either as a body containing a current density or containing
some magnetic charge. Rare-earth magnets have the convenient property
of high coercivity that prevents demagnetisation; hence, assumptions
of a fixed and volume-constant magnetisation hold very well.

In the first step, the integration takes place over the region of the
first magnet:
\begin{dmath}
\magB_1\fn{\pos_2} =
  \magconst\Int{
    \gp{-\Div\magM_1}
    \frac{\pos_2-\pos_1}{\Abs{\pos_2-\pos_1}^3}}{v_1,V_1}
+ \magconst\oint\limits_{S_1}
    \gp{\magM_1\dotprod\normn}
    \frac{\pos_2-\pos_1}{\Abs{\pos_2-\pos_1}^3}
    \dee s_1
\end{dmath}.

In the second step, the integration of the function of the magnetic
field of the first magnet takes place over the region of the second
magnet:
\begin{dmath}
\force =
  \int\limits_{V_2}
  \gp{-\Div\magM_2}
  \magB_1\fn{\pos_2} \dee v_2
+ \oint\limits_{S_2}
  \gp{\magM_2\dotprod\normn}
  \magB_1\fn{\pos_2} \dee s_2
\end{dmath}.

Torque is similar.
\begin{dmath}
\torque =
  \int\limits_{V_2}
  \gp{-\Div\magM_2}
  \gp{  \lever\crossprod\magB_1\fn{\pos_2} } \dee v_2
+ \oint\limits_{S_2}
  \gp{  \magM_2\dotprod\normn       }
  \gp{  \lever\crossprod\magB_1\fn{\pos_2} } \dee s_2
\end{dmath}.

The volume integrals contain $\Div\magM$ terms, which will equal zero
in the regions of constant magnetisation within the regions of the
magnetic volumes. This is a reasonable assumption for modern rare
earth magnetic material. The equations above can therefore be
simplified.

\begin{dmath}
\magB_1\fn{\pos_2} =
  \magconst\oint\limits_{S_1}
    \gp{  \magM_1\dotprod\normn  }
    \frac{\pos_2-\pos_1}{\Abs{\pos_2-\pos_1}^3}
    \dee s_1
\end{dmath},
\begin{dmath}
\force =
  \oint\limits_{S_2}
  \gp{  \magM_2\dotprod\normn  }
  \magB_1\fn{\pos_2} \dee s_2
= \magconst
  \oint\limits_{S_2}
  \oint\limits_{S_1}
    \gp{  \magM_1\dotprod\normn_{s_1}  }
    \gp{  \magM_2\dotprod\normn_{s_2}  }
    \frac{\pos_2-\pos_1}{\Abs{\pos_2-\pos_1}^3}
    \dee s_1
  \dee s_2
\end{dmath},
\begin{dmath}
\torque =
  \oint\limits_{S_2}
    \gp{  \magM_2\dotprod\normn       }
    \gp{  \lever\crossprod\magB_1\fn{\pos_2} }
  \dee s_2
 =
  \magconst
  \oint\limits_{S_2}
    \gp{  \magM_2 \dotprod \normn_{s_2} }
    \gp{
      \lever\crossprod
      \gp{
        \oint\limits_{S_1}
          \gp{  \magM_1\dotprod\normn_{s_1}  }
          \frac{\pos_2-\pos_1}{\Abs{\pos_2-\pos_1}^3}
        \dee s_1
      }
    }
  \dee s_2
\end{dmath}.

\subsection{Analytical force expressions}

Expressions for the forces between magnets follow directly from
Maxwell's equations, and may be derived in a number of ways.

\noindent Say $f$ integrates to $F$:
\begin{dmath*}
\iiint f(x,y,z)\dee{x}\dee{y}\dee{z} = F(x,y,z),
\end{dmath*}
\begin{dmath*}
\iiint f(x,y,z) \dee{x}\dee{y}\dee{z} =
  \mathop{\sum\sum\sum}\limits_{i,j,k\in\{1,2\}} F(x_i,y_j,z_k)\cdot(-1)^{i+j+k}
\end{dmath*}


\subsubsection{(Anti-)parallel magnets}

A variety of analytical solutions have been developed to calculate the
force between cuboid-shaped magnets with parallel/anti-parallel
magnetisations \cite{akoun1984,nagaraj1988,bonisoli2006}. More complex
geometries can be realised through superposition of the solutions
\cite{bancel1999}. \citeauthor{akoun1984}'s expression is
\begin{dmath}[label=akoun]
\vect F = \frac{JJ'}{4\pi\permVac}
  \sum_{(i,j,k,l,p,q)\in\{0,1\}^6}
  \vect f\fn{u_{ij},v_{kl},w_{pq},r}
  \fixme{!!}
\end{dmath},
\begin{dgroup}
\begin{dmath}
f_x = \half\gp{v^2-w^2}\Log{r-u}+uv\Log{r-v}+vw\ArcTan{\frac{uv}{rw}}+\half ru
\end{dmath},
\begin{dmath}
f_y = \half\gp{u^2-w^2}\Log{r-v}+uv\Log{r-u}+uw\ArcTan{\frac{uv}{rw}}+\half rv
\end{dmath},
\begin{dmath}
f_z = -uw\Log{r-u}-vw\Log{r-v}+uv\ArcTan{\tfrac{uv}{rw}}-rw
\end{dmath},
\end{dgroup}
where
\begin{dgroup}
\begin{dmath}
u_{ij} = \alpha + \gp{-1}^j A - \gp{-1}^i a
\end{dmath},
\begin{dmath}
v_{kl} = \beta + \gp{-1}^l B - \gp{-1}^k b
\end{dmath},
\begin{dmath}
w_{pq} = \alpha + \gp{-1}^q C - \gp{-1}^p c
\end{dmath},
\begin{dmath}
r = \sqrt{u_{ij}^2+v_{kl}^2+w_{pq}^2}
\end{dmath},
\end{dgroup}
where $\cuboida{1,2,3}$ and $\cuboidb{1,2,3}$ are the half dimensions of
the fixed and floating magnets, respectively, and
$\cuboidoffset{1,2,3}$ is the distance between their centres;
$J$ and $J'$ are the magnetisations, and $\permVac$ is the permeability
of free space.

And here are the stiffnesses:
\begin{dgroup}
\begin{dmath}
k_x = -\frac{v u^2}{u^2+w^2}-r-v \Log{r-v}
\end{dmath},
\begin{dmath}
k_y = -\frac{u v^2}{v^2+w^2}-r-u \Log{r-u}
\end{dmath},
\begin{dmath}
k_z = \frac{v w^2}{u^2+w^2}
  + \frac{u w^2}{v^2+w^2}
  + 2r+u\Log{r-u}+v \Log{r-v}
\end{dmath}.
\end{dgroup}
These are substituted similarly to the force equations:
\begin{dmath}[label=akounk]
\vect K = \frac{JJ'}{4\pi\permVac} \sum_{(i,j,k,l,p,q)\in\{0,1\}^6} \vect k\fn{u_{ij},v_{kl},w_{pq},r} .
\end{dmath}

Note that the result $K_x+K_y+K_z=0$ follows from Earnshaw's theorem
\cite{earnshaw1842} following from the solution to Laplace's equation.

\section{Simplified force and stiffness expression for cube magnets}

The function $\nforce$ is the simplication of \eqref{akoun}
formula after the assumptions given in \secref{mag}, where $J_1$ and
$J_2$ are the magnetisations of the two magnets and
$\permVac=4\pi\times10^{-7}$ is the `permeability of the vacuum':
\begin{dmath}[label=nforce]
  \nforce = \frac{J_1J_2}{\pi\permVac} \baraccent{\nforce}
\end{dmath}
where
\begin{dmath}
  \baraccent{\nforce} = \gp{-2+\ndisp}\cdot\Abs{-2+\ndisp}-2 \ndisp \Abs{\ndisp}+\gp{2+\ndisp}\cdot
  \Abs{2+\ndisp}+4 \ndisp \sqrt{4+\ndisp^2}
  -2 \ndisp \sqrt{8+\ndisp^2}+\gp{4-2 \ndisp} \sqrt{8-4
    \ndisp+\ndisp^2}+\gp{-2+\ndisp} \sqrt{12-4 \ndisp+\ndisp^2}
  +\gp{-4-2 \ndisp} \sqrt{8+4 \ndisp+\ndisp^2}+\gp{2+\ndisp}
  \sqrt{12+4 \ndisp+\ndisp^2}
  +2 \left[ 4 \mathatan\left[\frac{4}{\ndisp \sqrt{8+\ndisp^2}}\right]+2
    \mathatan\left[\frac{4}{\gp{2-\ndisp}
        \sqrt{12-4 \ndisp+\ndisp^2}}\right]\right.
  -2 \mathatan\left[\frac{4}{\gp{2+\ndisp} \sqrt{12+4 \ndisp+\ndisp^2}}\right]+2 \ndisp
  \mathlog\left[-2+\sqrt{4+\ndisp^2}\right]
  -2 \ndisp \mathlog\left[2+\sqrt{4+\ndisp^2}\right]-2 \ndisp
  \mathlog\left[-2+\sqrt{8+\ndisp^2}\right]
  +2 \ndisp \mathlog\left[2+\sqrt{8+\ndisp^2}\right]+2
  \mathlog\left[-2+\sqrt{8-4
      \ndisp+\ndisp^2}\right]
  -\ndisp \mathlog\left[-2+\sqrt{8-4 \ndisp+\ndisp^2}\right]-2
  \mathlog\left[2+\sqrt{8-4 \ndisp+\ndisp^2}\right]
  +\ndisp \mathlog\left[2+\sqrt{8-4 \ndisp+\ndisp^2}\right]-2
  \mathlog\left[-2+\sqrt{12-4 \ndisp+\ndisp^2}\right]
  +\ndisp \mathlog\left[-2+\sqrt{12-4 \ndisp+\ndisp^2}\right]+2
  \mathlog\left[2+\sqrt{12-4 \ndisp+\ndisp^2}\right]
  -\ndisp \mathlog\left[2+\sqrt{12-4 \ndisp+\ndisp^2}\right]-2
  \mathlog\left[-2+\sqrt{8+4 \ndisp+\ndisp^2}\right]
  -\ndisp \mathlog\left[-2+\sqrt{8+4 \ndisp+\ndisp^2}\right]+2
  \mathlog\left[2+\sqrt{8+4 \ndisp+\ndisp^2}\right]
  +\ndisp \mathlog\left[2+\sqrt{8+4 \ndisp+\ndisp^2}\right]+2
  \mathlog\left[-2+\sqrt{12+4 \ndisp+\ndisp^2}\right]
  +\ndisp \mathlog\left[-2+\sqrt{12+4 \ndisp+\ndisp^2}\right]-2
  \mathlog\left[2+\sqrt{12+4 \ndisp+\ndisp^2}\right]
  \left.  -\ndisp \mathlog\left[2+\sqrt{12+4 \ndisp+\ndisp^2}\right]\right]
\end{dmath}

The normalised stiffness $\nstiffness$ is calculated by differentiating the force equations given by \textcite{akoun1984} before simplifying as with the force terms above:
\begin{dmath}[label=nstiffness]
  \nstiffness = -\frac{2J_1J_2}{\pi\permVac} \baraccent{\nstiffness}
\end{dmath}
where
\begin{dmath}
  \baraccent{\nstiffness} = \Abs{-2+\ndisp}-2 \Abs{\ndisp}+\Abs{2+\ndisp}+4
  \sqrt{4+\ndisp^2}-2\sqrt{8+\ndisp^2}
  -2 \sqrt{8-4 \ndisp+\ndisp^2}+\sqrt{12-4 \ndisp+\ndisp^2}-2 \sqrt{8+4\ndisp+\ndisp^2}
  +\sqrt{12+4 \ndisp+\ndisp^2}+2 \mathlog\left[-2+\sqrt{4+\ndisp^2}\right]
  -2\mathlog\left[2+\sqrt{4+\ndisp^2}\right]
  -2\mathlog\left[-2+\sqrt{8+\ndisp^2}\right]
  +2\mathlog\left[2+\sqrt{8+\ndisp^2}\right]
  -\mathlog\left[-2+\sqrt{8-4 \ndisp+\ndisp^2}\right]
  +\mathlog\left[2+\sqrt{8-4\ndisp+\ndisp^2}\right]
  +\mathlog\left[-2+\sqrt{12-4\ndisp+\ndisp^2}\right]
  -\mathlog\left[2+\sqrt{12-4\ndisp+\ndisp^2}\right]
  -\mathlog\left[-2+\sqrt{8+4 \ndisp+\ndisp^2}\right]
  +\mathlog\left[2+\sqrt{8+4\ndisp+\ndisp^2}\right]
  +\mathlog\left[-2+\sqrt{12+4\ndisp+\ndisp^2}\right]
  -\mathlog\left[2+\sqrt{12+4 \ndisp+\ndisp^2}\right]
\end{dmath}

\subsubsection{Orthogonal magnets}

Much more recently, \textcite{janssen2009-sensorletters} have shown analytical expressions to calculate the force between two magnets with orthogonal magnetisations.

\fxfatal{include}

\subsection{Arbitary magnetisations}

Most force expressions are derived from magnetic field equations that are assumed from magnets with magnetisation parallel to one of their sides.
Superposition can then be used to combine the expressions for orthonogal magnets to generate the force from a magnet with arbitrary magnetisation.
\textcite{ravaud2009-pier98} instead show the magnetic field equations for a cuboid magnet with arbitrary magnetisation; their work is still to be extended to calculate the forces between such magnets.

The geometry of the two-magnet system is shown in Figure~\ref{diagram}, in which the magnets have side lengths $\bm s = [2a, 2b, 2c]\T$ and $\bm S = [2A, 2B, 2C]\T$ respectively and the distance between their centres is given by $\bm d=[\alpha,\beta,\gamma]\T$. The calculations always assume that the first magnet is fixed and force is acting on the second magnet. The signs must be reversed to obtain the forces acting on the first magnet.

\begin{figure}[t]
\centering
\asyfig{Magnets/akoun}
\caption{Depiction of the geometry for the two-magnet system.}
\label{diagram}
\end{figure}

\textcite{akoun1984} provide the force expressions for magnets with vertical magnetisations. This force is denoted herein as $\bm F_{z,z}\fn{\bm s, \bm S, \bm d, J_1, J_2}$ as a function of the magnet sizes, the distance between them, and their magnetisation magnitudes $J_1$ and $J_2$. \textcite{allag2009-electromotion} provide the force expressions for the first magnet with vertical magnetisation and the second magnet with magnetisation in the horizontal $y$-direction. This force is denoted herein as $\bm F_{z,y}\fn{\bm s, \bm S, \bm d, J_1, J_2}$.

The force between a vertically-magnetised magnet and one with magnetisation in the horizontal $x$-direction can be calculated by applied a rotational transformation to $\bm F_{z,y}$ around the $z$-axis. That is,
\begin{multline}\label{fzx}
\bm F_{z,x}\fn{\bm s, \bm S, \bm d, J_1, J_2} = \\\mathbf R_z\fn{-\tfrac{\pi}2}\bm F_{z,y}\fn{\bm s_{z,x}, \bm S_{z,x},\bm d_{z,x}, J_1, J_2} ,
\end{multline}
where
\begin{align}
\bm s_{z,x} &= \Abs{\mathbf R_z\fn{\tfrac\pi2}\bm s}, \\
\bm S_{z,x} &= \Abs{\mathbf R_z\fn{\tfrac\pi2}\bm S}, \\
\bm d_{z,x} &= \mathbf R_z\fn{\tfrac\pi2}\bm d,
\end{align}
for which $\Abs{\cdot}$ is the \emph{element-wise} absolute value function and $\mathbf R_z\fn{\theta}$ is the rotation matrix around the $z$-axis:
\begin{equation}
\mathbf R_z\fn\theta = \begin{bmatrix}
\cos\theta & -\sin\theta & 0 \\
\sin\theta & \hphantom{-{}}\cos\theta & 0 \\
0 & 0 & 1
\end{bmatrix}.
\end{equation}

Using the force expressions $\bm F_{z,x}$, $\bm F_{z,y}$, and $\bm F_{z,z}$ in superposition allow the force to be calculated between a vertically magnetised magnet and another magnet with arbitrary magnetisation direction. By applying c\"oordinate system transformations to these expressions, arbitrary magnetisation directions can be achieved for the first magnet as well.

For horizontal $x$-direction magnetisation,
\begin{multline}\label{fxxyz}
\bm F_{x,\{x,y,z\}}\fn{\bm s, \bm S, \bm d, J_1, J_2} = \\
  \mathbf R_y\fn{\tfrac\pi2} 
  \bm F_{z,\{x,y,z\}}\fn{\bm s_x, \bm S_x, \bm d_x, J_1, J_2}
\end{multline}
where
\begin{align}
\bm s_x &= \Abs{\mathbf R_y\fn{-\tfrac\pi2}\bm s}, \\
\bm S_x &= \Abs{\mathbf R_y\fn{-\tfrac\pi2}\bm S}, \\
\bm d_x &= \mathbf R_y\fn{-\tfrac\pi2}\bm d,
\end{align}
and $\mathbf R_y\fn{\theta}$ is the rotation matrix around the $y$-axis:
\begin{equation}
\mathbf R_y\fn\theta = \begin{bmatrix}
\cos\theta & 0 & -\sin\theta \\
0 & 1 & 0 \\
\sin\theta & 0 & \hphantom{-{}}\cos\theta \\
\end{bmatrix}.
\end{equation}
Similarly, for horizontal $y$-direction magnetisation,
\begin{multline}\label{fyxyz}
\bm F_{y,\{x,y,z\}}\fn{\bm s, \bm S, \bm d, J_1, J_2} = \\
  \mathbf R_x\fn{-\tfrac\pi2} 
  \bm F_{z,\{x,y,z\}}\fn{\bm s_y, \bm S_y, \bm d_y, J_1, J_2}
\end{multline}
where
\begin{align}
\bm s_y &= \Abs{\mathbf R_x\fn{\tfrac\pi2}\bm s}, \\
\bm S_y &= \Abs{\mathbf R_x\fn{\tfrac\pi2}\bm S}, \\
\bm d_y &= \mathbf R_x\fn{\tfrac\pi2}\bm d,
\end{align}
and $\mathbf R_x\fn{\theta}$ is the rotation matrix around the $x$-axis:
\begin{equation}
\mathbf R_x\fn\theta = \begin{bmatrix}
1 & 0 & 0 \\
0 & \cos\theta & -\sin\theta \\
0 & \sin\theta & \hphantom{-{}}\cos\theta \\
\end{bmatrix}.
\end{equation}

Given the results of the afore-referenced papers by Yonnet et al. and Equations \eqref{fzx}, \eqref{fxxyz}, and~\eqref{fyxyz}, the force between two magnets of arbitrary magnetisation can be written as
\begin{equation}\label{total-force}
\bm F\fn{\bm s, \bm S, \bm d,\bm J_1,\bm J_2}=\sum_{i,j\in\{x,y,z\}^2} \bm F_{i,j}\fn{\bm s, \bm S, \bm d, J_{1_i}, J_{2_j}}
\end{equation}
where
\begin{align}
\bm J_1 &= [J_{1_x},J_{1_y},J_{1_z}]\T, &
\bm J_2 &= [J_{2_x},J_{2_y},J_{2_z}]\T.
\end{align}
The theory to evaluate \eqref{total-force} is implemented in the Matlab function `magnetforces'.

\subsubsection{Examples}

The verification curve of the results of \textcite{akoun1984}, calculated using \eqref{total-force} with the `magnetforces' function, is shown in Figure~\ref{akoun} for the following system:
\begin{align}
\begin{split}
\bm s &=[\SI{20}{mm}, \SI{12}{mm}, \SI{6}{mm}]\T\\
\bm S &=[\SI{12}{mm}, \SI{20}{mm}, \SI{6}{mm}]\T\\
\bm d &=[\SI{-4}{mm}+\delta, \SI{-4}{mm}, \SI{8}{mm}]\T\\
\bm J_1,\bm J_2&=[0,0,\SI{0.38}{T}]\T
\end{split}
\end{align}

\begin{figure}
\centering
\psfragfig{magcode/examples/fig/akoun-repro}
\caption{Reproduction of the results shown by \textcite{akoun1984}.}
\label{akoun}
\end{figure}


The verification curve of the results shown by \textcite{janssen2009-sensorletters} is shown in Figure~\ref{janssen} for the following system:
\begin{align}
\begin{split}
\bm s &=[\SI{10}{mm}, \SI{26}{mm}, \SI{14}{mm}]\T\\
\bm S &=[\SI{14}{mm}, \SI{26}{mm}, \SI{10}{mm}]\T\\
\bm d &=[\delta, \SI{-8}{mm}, \SI{15}{mm}]\T\\
\bm J_1 &=[0,0,\SI{1}{T}]\T,\qquad
\bm J_2=[\SI{1}{T},0,0]\T
\end{split}
\end{align}

\begin{figure}
\centering
\psfragfig{magcode/examples/fig/janssen-repro}
\caption{Reproduction of the results of \textcite{janssen2009-sensorletters}.}
\label{janssen}
\end{figure}

The Matlab code to generate Figures \ref{akoun} and~\ref{janssen} is located in the file `examples/magnetforces\_example.m' (see Section~\ref{code}).


\subsection{Other approaches}

To account for magnets that do not have parallel/anti-parallel
magnetisation, \textcite{chen2002,chen2003} derived an expression in two
dimensions for the force induced between two L-shaped current
sheets, then applies this model with the length
of various legs of the `L' in different configurations set to zero. This
takes the assumption, like \textcite{yonnet1981}, of infinitely long
planar cross sections.
This was suitable for application to a magnetic bearing where
the curvature of the magnet has a small or negligible effect on the
force between the magnets. However, for true three dimensional cases
(such as the forces between two cube magnets) this technique would not
be suitable.

Rotation of a magnet around an axis is treated by Eliès, Charpentier and
Lemarquand in numerous papers
\cite{elies1998,charpentier1999-ietm-mar,charpentier1999-ietm-sep,elies1999a}, giving equations
for the forces in the directions other than around which the magnet is
rotated. Since the equations they present are not self-consistent (some typing
mistakes have occurred in the publications of the papers), the correct form is
printed in \secref{french-equations} in an easier to read, abbreviated form.

\textcite{nagaraj1988} derived integrals using the current method
\fxfatal{crossref} to calculate the forces between cuboid magnets and
between cylindrical magnets, and compared the differences in
behaviour.

More complex behaviours, however, cannot be solved analytically as the
integrals become untractable; for anything approaching the forces
between two magnets with arbitrary rotations, \emph{numerical}
integration must be used \cite{elies1999a}. This technique is capable
of obtaining results in a much more straightforward manner than finite
element analysis, and must be used for the more complex situations.

\subsection{Abbreviated equations}
\seclabel{french-equations}

In 1999, a slew of papers were published by researchers at \emph{Laboratoire
d'Electrotechnique et de Magnétisme de Brest} investigating the forces between
non-contact magnetic rotational force couplers. These are of interest to this
work because they use an analytical expression for the forces between two
cuboidal magnets under arbitrary translation, with one inclined at any angle
around the \x-axis.

This article talks about the forces between two cuboid magnets at arbitrary
angles to each other, and shows the integral used to solve the problem.
Numerical techniques are used, however, so I'm only interested in their pretty
picture and the integral itself.

Incidentally, there's nothing special about this particular integral; it's the
same one used by Bancel in his Magnetic Nodes paper. You kind of need a
picture, and I don't like the notation, but:
\begin{dmath}
  \magB_1 =
    \iint_{S_{1+}}
      \frac{J}{4\pi}
      \frac{\vect{P}_{S_{1+}}\vect{P}}
           {\overline{P_{S_{1+}}P}^3}
    \dee{S_{1+}}
    -
    \iint_{S_{1-}}
      \frac{J}{4\pi}
      \frac{\vect{P}_{S_{1-}}\vect{P}}
           {\overline{P_{S_{1-}}P}^3}
    \dee{S_{1-}},
  \\
  \vect{F} =
    \iint_{S_{2+}}
      \frac{J}{\permVac}\magB_1
    \dee{S_{2+}}
    -
    \iint_{S_{2-}}
      \frac{J}{\permVac}\magB_1
    \dee{S_{2-}}.
\end{dmath}
This is different to the work of \textcite{akoun1984}, who derive an
expression for the interaction energy between the two magnets and then
differentiate to get the forces.

These expressions follow the work of \textcite{bancel1999}, who defined his
equations as a set of nested functions, unlike the equations of
\textcite{akoun1984} that were six-nested summations. Back to these new
papers, three were published \cite{elies1998,charpentier1999-ietm-mar,charpentier1999-ietm-sep}
that all contain the expression I am interested in (why didn't they just cite
the original?), with a fourth \cite{elies1998} containing just the force
expression in a single direction. There's a little bit extra in the paper by
\cite{elies1999a} that looks at the forces of two magnets inclined around the
vertical axis, calculated with a numerical integration. The final paper
\cite{elies1999} involves couplings exclusively, making it less applicable to
this work. Its inclusion here is for completeness.

So, what is this equation that is so useful for me? Given two magnets located
in \threeD/ space, of sizes $\inlinevect{A,B,C}$ and $\inlinevect{a,b,c}$,
with the plane of the second rotated by $\theta$ around the \x-axis and their
origins offset by $\inlinevect{x_0,y_0,z_0}$, the forces in the \y- and
\z-directions ($F_y$ and $F_z$) between the two magnets can be calculated.

Forces in both the $y$ and $z$ direction use the $f_3$ function in
their calculations.
\begin{dgroup*}
\begin{dmath}
F_y = \frac{J^2}{4\pi\permVac}
  \sum_{i_{a,b,c,A,B,C}\in\{0,1\}}
  f_{y_2}\cdot\gp{-1}^{i_a+i_b+i_c+i_A+i_B+i_C}
\end{dmath},
\begin{dmath}
F_z\bigg|_{\theta\neq k\pi} =
       \frac{-J^2}{4\pi\permVac}\cdot\smash{\sum_{i_{a,b,c,A,B,C}\in\{0,1\}}}
        f_{z_2}\cdot\gp{-1}^{i_a+i_b+i_c+i_A+i_B+i_C}
\end{dmath},
\begin{dmath}
f_{y_2} = f_3\fn{u_0 , y_0 , z_0 , \theta , c i_c , C i_C}
\end{dmath},
\begin{dmath}
f_{z_2} =  f_3\fn{u_1,v_1,w_1,-\theta,0,0}/{\sin\theta}
         + f_3\fn{u_2,v_2,w_2,\theta,0,0}/{\tan\theta}
\end{dmath},
\begin{dmath}
u_0 = x_0 - ai_a + Ai_A
\end{dmath},
\begin{dmath}
u_1 = u_0-2x_0
\end{dmath},
\begin{dmath}
v_1 = -v_2\cos\theta - w_2\sin\theta
\end{dmath},
\begin{dmath}
w_1 = v_2\sin\theta - w_2\cos\theta
\end{dmath},
\begin{dmath}
v_2 = y_0-Ci_C\sin\theta
\end{dmath},
\begin{dmath}
w_2 = z_0-ci_c+Ci_C\cos\theta
\end{dmath}.
\end{dgroup*}
This is the auxiliary function used in the above. All dashed variables are
local to this function.
\begin{dgroup*}
\begin{dmath}
f_3\fn{u',v',w',\theta',c',C'} =
  u' f_5\gp{\Log{f_4-u'}-1}
  +\half\gp{f_6^2-{u'}^2}\Log{f_4+f_5}
  +\half u' \pi \Sign{f_5}\Abs{f_6}
  +u' f_6 \ArcTan{\frac{u' f_4 - u^2 -f_6^2}{f_5 f_6}}
  +\half f_4 f_5
\end{dmath},
\begin{dmath}
f_4 = \sqrt{{u'}^2+f_5^2+f_6^2}
\end{dmath},
\begin{dmath}
f_5 = \gp{v'-b i_b}\cos\theta'+\gp{w'-c'}\sin\theta'+B i_B
\end{dmath},
\begin{dmath}
f_6 = -\gp{v'-b i_b}\sin\theta'+\gp{w'-c'}\cos\theta'+C'
\end{dmath}.
\end{dgroup*}

The force in the $z$ direction is calculated separately if the second
magnet is not rotated around its axis ($f_{z_2}$ has a singularity
at $\theta=k\pi$).
\begin{dgroup}
\begin{dmath}
F_z\bigg|_{\theta=k\pi} =
  \cos\theta\cdot\frac{-J^2}{4\pi\permVac}
  \sum_{i_{a,b,c,A,B,C}\in\{0,1\}}f_{z_1}
  \cdot\gp{-1}^{i_a+i_b+i_c+i_A+i_B+i_C}
\end{dmath},
\begin{dmath}
f_{z_1} =
  \half uw\Log{\frac{r+u}{r-u}}+\half vw\Log{\frac{r+v}{r-v}}+
  uv\ArcTan{\frac{uv}{wr}-wr}
\end{dmath},
\begin{dmath}
u = x_0-ai_i+Ai_A
\end{dmath},
\begin{dmath}
v = y_0-bi_b+Bi_B+\half B\gp{\cos\theta-1}
\end{dmath},
\begin{dmath}
w = z_0-ci_c+Ci_C+\half C\gp{\cos\theta-1}
\end{dmath},
\begin{dmath}
r = \sqrt{u^2+v^2+w^2}
\end{dmath}.
\end{dgroup}

This equation is very similar, but not identical, to Akoun~\& Yonnet's
equation for the same thing. I suspect theirs is more simple because they
integrate over symmetric limits of integration (\eg, $\int^{+a}_{-a}$). Terms
that are odd functions integrate to zero in this case.

In order to allow this equation to be used for rotations greater than
\SI{\sipi}{radians}, additional terms have been added to accommodate for the
translational offset induced by rotating the magnet around its lower-left
edge. The preceding $\cos\theta$ provides the sign change of the
magnetisation, and the $\half\gp{\cos\theta-1}$ terms are used to return the
origin of the magnet after 180\textdegree\ rotation to the lower-left corner,
where it is expected.

\subsection{Quick results}

I can confirm that Charpentier's equations, and my simplifications thereof,
are consistent and give reasonable results. \Figref{charp-rotate} shows the
forces produced between two \SI{10}{mm} cube magnets as a function of rotation
angle $\theta$ of the second magnet, with a \SI{20}{mm} offset between their
centres. Two cases are shown: in the first , the magnets are displaced
vertically; in the second, the magnets are displaced horizontally.

\begin{figure}
  \begin{wide}
  \begin{subfigure}
    \psfragfig{\phdpath Simulations/Theory/latex/charp-rotation-forces}
    \caption{Vertical displacement.}
  \end{subfigure}
  \hfil
  \begin{subfigure}
    \psfragfig{\phdpath Simulations/Theory/latex/charp-horiz-rotation-forces}
    \caption{Horizontal displacement.}
  \end{subfigure}
  \hfil
  \null
  \end{wide}
  \caption{Vertical and horizontal forces on a rotating magnet
    as a function of rotation angle for fixed horizontal and vertical displacements.}
  \figlabel{charp-rotate}
\end{figure}

\Figref{charp-rotate} shows that the maximum force between two magnets is
exhibited when the direction of displacement is in the same direction as their
magnetisations. For displacements perpendicular to the direction of
magnetisation of the fixed magnet, forces of equal magnitude are obtained for
rotation of the second magnet $\theta=k\pi/2$ for $k\in\{0,1,2,\dots\}$.

\fxfatal{cross ref yonnet (?) old result for bearings having same force}

In the following simulations, the second
magnet is held at a constant height (one magnet height's separation distance)
and moved from left to right over a range of twice the magnet width
symmetrically above the first magnet (with respect to the magnets' centres of
gravity). Four such displacements are made with four different rotations for
the second magnet: $0$, $\half\pi$, $\pi$ and $-\half\pi$.
\Figref{charp-0to2pi-Fy} shows the forces in the horizontal \y-direction;
\Figref{charp-0to2pi-Fz} the forces in the vertical \z-direction. It can be
seen that the opposite rotations result in symmetric forces curves, as is
expected.

Now these expressions can be used to calculate analytically the forces between
multipole arrays with arbitrary numbers of magnet per wavelength.

\begin{figure}
  \centering
  \psfragfig{\phdpath Simulations/Theory/latex/charp-0to2pi-Fy}
  \caption{Horizontal forces on a rotating magnet situated directly above another.}
  \figlabel{charp-0to2pi-Fy}
\end{figure}

\begin{figure}
  \centering
  \psfragfig{\phdpath Simulations/Theory/latex/charp-0to2pi-Fz}
  \caption{Vertical forces on a rotating magnet situated directly above another.}
  \figlabel{charp-0to2pi-Fz}
\end{figure}



\section{Reproducible research}

Some of the results presented in this thesis are reproducible \parencite{kovacevic2007-icassp} with code located at \url{http://www.github.com/wspr/magcode}. This is a software implementation in both Matlab and Mathematica  of much of the above theory for calculating the forces between magnets and multipole arrays of magnets, and is freely available to be used by the public.

This code is written to provide a convenient interface to the theory presented above.

Blah blah blah.

