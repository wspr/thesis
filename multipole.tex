%!TEX root = thesis.tex

\chapter{Multipole}
\chaplabel{multipole}

\chapterprecis{
  This chapter investigates techniques for increasing the forces between arrays
  of magnets, and looks at how these techniques may be integrated into a
  magnetic spring design. This is largely unfinished because my results are
  a little funny, and inconclusive. I use the theory introduced in \chapref{magnet-theory}
  to investigate the forces between multiple arrays which are composed of
  magnets with rotating polarisations; this approximates a magnet with sinusoidal
  polarisation. The amount of discretisation and the spatial wavelength of
  magnetisation of the arrays both influence the resulting forces.
}

\referpaper{The material presented in \secref{optim-halbach-1d} is based on work that has been published as a journal paper~\cite{robertson2010-maglett}.}

\section{Multipole}

The next requirement of the design of the magnetic spring is high load
capacity. Since radial magnetic bearings work directly with trying to achieve
large forces from arrangements of magnets, it is possible to look to this
literature to find prior art. Recall from the literature (see
\secref{multipole}) that \citeauthor{yonnet1991} were able to increase the
stiffness of their radial bearing by applying Halbach arrays. This application
uses opposing Halbach arrays, but other configurations are possible.

An examination of the flux lines of various facing Halbach arrays, as shown in
\figref{halbach-flux-repl,halbach-flux-attr}, shows how flux interacts between
the two separate linear arrays. It can be seen that simply by varying the
direction of magnetisation of the first magnet in the second array, a full
sinusoid of forces can be achieved between the arrays—at the limits, total
attraction or repulsion in the vertical direction, as for
\figref{halbach-flux-repl,halbach-flux-attr} respectively.

\begin{figure}
  \begin{subfigure}
  \grf[scale=0.67]{Figures/Multipole/2-halb-repl}
  \caption{In repulsion.}
  \figlabel{halbach-flux-repl}
\end{subfigure}
\begin{subfigure}
  \grf[scale=0.67]{Figures/Multipole/2-halb-attr}
  \caption{In attraction.}
  \figlabel{halbach-flux-attr}
\end{subfigure}
\caption{Magnetic field lines of linear multipole arrays.}
\end{figure}

In this configuration, then, this restricts the relative lateral motion to
each other that the springs can experience. A slip by two magnet lengths, and
the spring will no longer be supporting load---it will be firmly attracted to
its former opposer! In practise, this is not a concern. The operation of the
spring is design such that free motion is opposed in the lateral directions,
and will be implemented with a physical stop (only at the extremes of
displacement so as to remain non-contact, of course) to prevent calamity of
this sort.

\section{Planar arrays}

The previous work covered deals with magnet arrays of homogeneously-magnetised
cross-section. \textcite{kim1997-thesis} cites a patent, in which he is involved,
that superimposes two orthogonal linear Halbach arrays to create a
\emph{planar} structure. \figref{pa-trumper} shows the structure, but in his
own planar levitator, \citeauthor{kim1997-thesis} actually uses a linear Halbach
array (later shown in \figref{pa-x2d}).

Planar arrays are used quite extensively in the field of planar permanent
magnet motors, and there have been some other array configurations developed.
Analysis of the magnetic flux produced by various planar arrays, including
Kim's, has been done by \textcite{cho2001}, culminating with the
design shown in \figref{pa-cho}. However, their uses have so far
been confined to applications that use the magnetic flux for providing motive
force; no analysis has been made on the \emph{forces} between arrays.

The author is unaware of any attempt to use Halbach arrays to increase the
load bearing efficiency of linear magnetic springs.

The `patchwork' array shown in \figref{pa-ns} is the most simple. See Hinds
cited by \textcite{kim1997-thesis}, or Chitayat cited by \textcite{cho2001} for its
use in other circumstances. The array used by \citeauthor{kim1997-thesis} is shown in
\figref{pa-x2d}, despite the fact that he demonstrated the Halbach
superposition. \fxfatal{crossref}

\begin{figure}
  \begin{subfigure}
    \grf{Figures/Multipole/pa-ns}
    \caption{Patchwork.}
    \figlabel{pa-ns}
  \end{subfigure}
  \hfil
  \begin{subfigure}
    \grf{Figures/Multipole/pa-x2d}
    \caption{Extended Halbach array.}
    \figlabel{pa-x2d}
  \end{subfigure}
  \caption{Two simple planar magnetic arrays.}
  \figlabel{pa-simple}
\end{figure}

\begin{figure}
   \grf{Figures/Multipole/pa-cho}
   \caption[Novel planar array shown in the literature.]{%
     The planar array by \textcite{cho2001}. Flux travels out of the page
     from the north- to south-faced magnets, and back through the \emph{array}
     in the triangular magnets.}
   \figlabel{pa-cho}
\end{figure}



\section{actuators}

\textcite{trumper1996} developed the electromagnetic analogue to the
Halbach array: a triangular coil-winding arrangement that produces
sinusoidal and predominantly single-sided flux. This technique could
prove especially well suited to generating forces against permanent
magnet arrays.


[\textcite{dasilveira2005}] Analytical expression for the normal force between two magnets on a back-iron plate and a perpendicular coil.
The system is for a planar actuator, and the motivation is to be able to determine the amount of out-of-plane force generated by a particular design.
Could very well be useful for some of my ideas.

\textcite{xia2008-ietm} calculates \threeD/ torque from a spherical multipole actuator.

\textcite{meessen2008-ietm} analysed quasi-Halbach and trapezoidal linear multipole arrays for slotless tubular actuators.
The trapezoidal shaped magnets are shown to generate slightly higher forces.

\section{Code}

A multipole array can be uniquely defined in terms of several sets of variables.   The simplest such description is:
\begin{itemize}
\item Size of each magnet $[\mupmaglength,d,h]\T$,
\item Number of magnets $T$, and
\item Magnetisation direction of the first magnet $\vartheta_0$ and rotation between successive magnets $\vartheta_i$.
\end{itemize}
Other variables that can also be used to describe the array are: (assuming an array aligned with the $x$-axis)
\begin{itemize}
\item Length of the array $\muplength = \mupmaglength T$,
\item Number of magnets per wavelength $M=2\pi/\vartheta_i$,
\item Wavelength of magnetisation $\mupwavelength= \mupmaglength M$, and
\item Number of wavelengths $N=[T-1]/M$.
\end{itemize}
Figure~\ref{multipole-variables} illustrates the relationship between magnet length, array length, and wavelength for an example linear array. The wavelength of magnetisation is the length required to achieve, with successive magnets, a full rotation of magnetisation direction.

Note the presence in Figures \ref{halbach} and~\ref{multipole-variables} and in general of an `end magnet' that adds symmetry to the discretisation of the magnetisation. This extra magnet is necessary to balance the forces in the horizontal direction.

Provided that enough information is specified and it is internally consistent, the Matlab implementation for calculating array forces can accept any combination of the variables listed above when defining the geometry of each array. Rather than explicitly enumerating the location of each magnet and the direction of its magnetisation, the implementation requires just an axis with which to align the array and the facing direction of its `strong' side.

\begin{figure}
\centering
\asyfig{Multipole/multipole-variables}
\caption{Geometry of a linear multipole array with 90\textdegree\ magnetisation rotations. This array contains two wavelengths of magnetisation with an end magnet for symmetry.}
\label{multipole-variables}
\end{figure}


\section{Forces between multipole magnet arrays}

A classical multipole or Halbach array is a linear array of magnets stacked to approximate a single magnet with sinusoidal magnetisation, first analysed in the '70s \parencite{halbach1981,shute2000}. Multipole arrays have been analysed for a variety of force-producing applications; only a small selection are included in the bibliography here \parencite{lee2004-mx,robertson2005,rovers2009-ietm}. One objective behind such a design is to focus the magnetic field on one side of the array, such to increase the forces exerted by which magnetic field on one side of the array and to reduce or eliminate any need for magnetic shielding on the reverse side. The magnetic field produced by one such multipole array is shown in Figure~\ref{halbach} in which the single-sided nature of the magnetic field can clearly be seen.

\begin{figure}
\centering
\includegraphics[width=\linewidth]{PhD/Figures/Multipole/halbach.pdf}
\caption{Magnetic field lines for a multipole array with 45\textdegree\ magnetisation rotations. The single-sided nature of the magnet field is evident.}
\label{halbach}
\end{figure}

Having expressed the forces between two magnets with arbitrary magnetisation, it becomes simple to use this expression iteratively over an array of magnets with varying magnetisation strengths or directions. The force between two arrays is simply the superposition of every combination of forces between the individual magnets in each array.

Some abstractions to the manner in which the iteration over each combination of magnets is performed allows us to simplify the code necessary to express a variety of configurations of the multiple arrays. This facilitates easy comparisons between different designs.

A multipole array can be uniquely defined in terms of several sets of variables.   The simplest such description is:
\begin{itemize}
\item Size of each magnet $[\mupmaglength,d,h]\T$,
\item Number of magnets $T$, and
\item Magnetisation direction of the first magnet $\vartheta_0$ and rotation between successive magnets $\vartheta_i$.
\end{itemize}
Other variables that can also be used to describe the array are: (assuming an array aligned with the $x$-axis)
\begin{itemize}
\item Length of the array $\muplength = \mupmaglength T$,
\item Number of magnets per wavelength $M=2\pi/\vartheta_i$,
\item Wavelength of magnetisation $\mupwavelength= \mupmaglength M$, and
\item Number of wavelengths $N=[T-1]/M$.
\end{itemize}
Figure~\ref{multipole-variables} illustrates the relationship between magnet length, array length, and wavelength for an example linear array. The wavelength of magnetisation is the length required to achieve, with successive magnets, a full rotation of magnetisation direction.

Note the presence in Figures \ref{halbach} and~\ref{multipole-variables} and in general of an `end magnet' that adds symmetry to the discretisation of the magnetisation. This extra magnet is necessary to balance the forces in the horizontal direction.

Provided that enough information is specified and it is internally consistent, the Matlab implementation for calculating array forces can accept any combination of the variables listed above when defining the geometry of each array. Rather than explicitly enumerating the location of each magnet and the direction of its magnetisation, the implementation requires just an axis with which to align the array and the facing direction of its `strong' side. This implementation is contained within the Matlab function `multipoleforces'.

\subsection{Example}

Allag et al.~\textcite{allag2009-electromotion} calculated the forces between two five-magnet multipole arrays with 90\textdegree\ rotation between successive magnets. Their results are reproduced in Figure~\ref{allag}, using the following parameters:
\begin{itemize}
\item Arrays aligned along $y$ and facing vertically $\pm z$.
\item $[m,d,h]\T = [\SI{0.01}{m},\SI{0.01}{m},\SI{0.01}{m}]\T$.
\item Total number of magnets $T = 5$ and number of magnets per wavelength of magnetisation $M=4$.
\item Displacement between arrays $\bm d=[0,\delta,\SI{0.015}{m}]\T$.
\end{itemize}
A schematic of this system is shown in Figure~\ref{allag-system}.

\begin{figure}
\centering
\asyfig{Multipole/allag-system}
\caption{Multipole system composed of \SI{10}{mm} cube magnets for $\delta=0$. Forces in the $y$- and $z$-directions as $\delta$ varies are shown in Figure~\ref{allag}.}
\label{allag-system}
\end{figure}

The Matlab code to generate Figure~\ref{allag} may be found in `examples/multipole\_example.m'. This is a good example of the convenience of using this framework for calculating results of this kind. Of the around 70 lines of code in `multipole\_example.m', only some 20 lines of code are necessary to set up the system parameters and calculate the forces; the rest of the file consists of comments, whitespace, and producing the actual figure itself.

\begin{figure}
\centering
\psfragfig{magcode/examples/fig/allag-repro}
\caption{Reproduction of Allag et al.'s results~\textcite{allag2009-electromotion}. The forces in the $x$-direction are zero.}
\label{allag}
\end{figure}

\subsection{Planar multipole arrays}

It is also possible to calculate the forces between magnet arrays with magnetisation as a function of position in two directions. For two multipole arrays of the structure shown in Figure~\ref{trumper-system} that have magnetisation directions based on the superposition of orthogonal linear multipole arrays, results are shown in Figure~\ref{trumper} for horizontal displacement with arrays composed of \SI{10}{mm} cube magnets and \SI{15}{mm} vertical displacement between the array centres. Each magnet of each array (except those with zero magnetisation) has a magnetisation of \SI{1}{T}. The Matlab code to generate Figure~\ref{trumper} is located in the file `examples/planar\_multipole\_example.m'.

Note the differences in the shape of the force curves between Figures \ref{allag} and~\ref{trumper}; in the planar multipole arrangement, the vertical force is largely positive even as the arrays shift into their attractive zone, whereas the linear multipole forces are more symmetrical and become significantly negative under a similar displacement. A more detailed comparison between various configurations of multipole arrays is currently under investigation and will be reported at a later date.

\begin{figure}
\centering
\includegraphics{PhD/Figures/Multipole/pa-trumper}
\caption{Planar multipole array, facing up, with magnetisation directions as the superposition of two orthogonal linear Halbach arrays. Non-filled arrowheads denote diagonal magnetisation and empty magnets have zero magnetisation.}
\label{trumper-system}
\end{figure}

\begin{figure}
\centering
\psfragfig{magcode/examples/fig/planar-halbach}
\caption{Force vs.\ horizontal displacement results for two planar multipole arrays such as shown in Figure~\ref{trumper-system}. The $x$-forces are all zero.}
\label{trumper}
\end{figure}



%%%%%%%%%%%%%%%%%

\section{Towards optimising the forces between linear Halbach arrays}
\seclabel{optim-halbach-1d}

\section{Introduction}

Linear springs constructed with permanent magnets can behave in interesting ways. In levitation contexts, the natural gravity-opposing characteristic with zero power input makes permanent magnets an appealing choice for force generation (e.g., see \cite{iniguez2009-jmmm}). In the context of supporting a variable-mass load for vibration isolation, the non-linear force vs.\ displacement characteristic decreases the amount of variability in the resonance frequency of the structure, since as the mass increases and closes the gap between the magnets, the stiffness also increases \parencite{bonisoli2007-mrc}. When used in attraction, the negative stiffness can be used to decrease the resonance frequencies of a supported mass, applicable for `high-static--low-dynamic' or `quasi--zero stiffness' springs \parencite{carrella2008-jsv,robertson2009-jsv}.

With well-known closed form solutions for calculating the forces between cuboid permanent magnets of parallel magnetisation \parencite{akoun1984} and solutions for the forces with orthogonal magnetisations recently published \parencite{janssen2009-sensorletters,allag2009-sensorletters}, it is now possible to analyse a wide variety of magnet configurations that previously required semi-analytical or finite element analsis techniques. This paper investigates the force characteristics between linear multipole magnet arrays as a function of array size and magnet arrangement using cuboid-shaped magnets. The forces are calculated using the force equations derived by the above researchers.

The results presented in this paper are reproducible \parencite{buckheit1995wavelab} with code located at \url{http://www.github.com/wspr/magcode}. This is a Matlab software package written by the authors for calculating the forces between magnets and multipole arrays of magnets, and is freely available to be used by the public. The directory \path{examples/magspring/} contains the code that has been used to directly generate the figures in this paper. Each figure caption refers to the file from which it is generated.

\section{Forces between single magnets}

Consider two equal cuboid-shaped permanent magnets facing in repulsion with vertical magnetisation and only vertical displacement between them. The shape of the cuboid has a dramatic affect on the force vs.\ displacement characteristic of the system. Assume square facing sides and a height-to-length ratio of $\hwratio$. For fixed magnet volume $\volume$, the height of the cuboid is $\sqrt[3]{\volume\hwratio^2}$ and the face size length is $\sqrt[3]{\volume/\hwratio}$. The force vs.\ displacement characteristic between two such magnets each with constant volume $\volume=(\SI{10}{mm})^3$ over a range of aspect ratios $\hwratio$ is shown in Figure~\ref{mag_ratio}. Displacement is measured between the near faces of the magnets. (Note that all forces in this paper are calculated assuming a magnetisation of \SI{1}{T} for all magnets. This value has been chosen to in effect normalise the output forces by the magnetisation strength.) These results show that for a constant volume of magnetic material a greater facing area yields greater forces.


\begin{figure}
\centering
\pregen{\psfragfig{examples/magspring/fig/mag_ratio}}
\caption{Force vs.\ displacement for pairs of repulsive magnets of constant volume each of $(\SI{10}{mm})^3$, comparing various magnet height-to-length ratios $\hwratio$. Calculated in the file `mag\_ratio.m'.}
\label{mag_ratio}
\end{figure}

\section{Linear multipole magnet arrays}

Large, flat, thin magnets can be difficult to obtain and hard to work with.
While multiple smaller magnets can be stacked together to approximate a single large magnet, greater forces can be achieved by varying the magnetisation pattern between adjacent magnets in the stack.
In the late '70s it was discovered that magnets with sinusoidal magnetisation produced single-sided magnetic fields \parencite{halbach1980,shute2000}, although it was known much earlier for magnetic bearings that stacks of shorter ring magnets with alternating magnetisations produced greater forces than a longer single ring magnet \parencite{backers1961}.

\section{Geometry and magnets arrangement}

In this paper we will consider a linear stack of magnets with $\mupNmag$ magnets aligned along an horizontal axis (often referred to as a linear Halbach array); planar and volumetric stacks that have multiple magnets in the other directions will not be considered here.
As the number of magnets per wavelength of magnetisation $\mupmagperwave$ increases, the magnetisation pattern of the array more closely approximates true sinusoidal magnetisation, as shown in Figure~\ref{wavelength}.

\begin{figure}
\centering
\pregen{\asyfig{PhD/Figures/Multipole/magperwave}}
\caption{Three Halbach arrays of equal length, facing up, each with a single wavelength of magnetisation and composed of $\mupmagperwave\in\{2,4,8\}$ magnets per wavelength respectively.}
\label{wavelength}
\end{figure}

The magnetic flux pattern of the array is dependent also on the wavelength of magnetisation $\mupwavelength$. As the wavelength of magnetisation decreases, the total number of magnets used in the array increases, for a fixed array length $\muplength$. The relationship between wavelength, array length, and number of magnets is shown in Figure~\ref{multipole-variables}. Note the one extra magnet included in Figures~\ref{wavelength} and~\ref{multipole-variables} such that the total number of wavelengths \mbox{$\mupNwaves=[\muplength-\mupmaglength]/\mupwavelength$} and the total number of magnets $\mupNmag=\mupNwaves\mupmagperwave+1$. This magnet is necessary to balance the forces in the horizontal direction such that only vertical forces are generated between the arrays.

\begin{figure}
\centering
\pregen{\asyfig{PhD/Figures/Multipole/multipole-variables}}
\caption{Geometry of a linear Halbach array with four magnets of length $\mupmaglength$ per wavelength of magnetisation $\mupwavelength$. This array contains two wavelengths of magnetisation with an end magnet for symmetry, i.e., $\mupNwaves=2$ and $\mupmagperwave=4$.}
\label{multipole-variables}
\end{figure}

There are two independent variables to consider when choosing the parameters for a linear Halbach array of a certain size: number of magnets per wavelength $\mupmagperwave$, and total number of wavelengths~$\mupNwaves$ in the array.

\subsection{Varying magnetisation discretisation and wavelength}

Consider two linear Halbach arrays of equal size with height $\mupheight=\SI{10}{mm}$, square cross section, and length $\muplength=\SI{100}{mm}$. Their strong sides are aligned towards each other and their magnetisation pattern is such that there is a repulsive force between them. The vertical displacement between their centres is $\mupvdispl$ which can be normalised by the height of the arrays; $\mupvdispl/\mupheight=1$ corresponds to the position at which the faces of the two arrays are touching. By calculating the forces between the arrays using superposition of the forces between each permutation of magnet pairs in the two arrays \parencite{allag2009-electromotion}, the force vs.\ normalised vertical displacement was calculated for the number of magnets per wavelength $\mupmagperwave\in\{2,4,8\}$ and the number of wavelengths $\mupNwaves\in\{1,2,4\}$ and compared to the forces generated between a pair of equivalently-sized magnets of homogeneous magnetisation. These results are shown in Figure~\ref{Nwaves}.

It can be seen in Figure~\ref{Nwaves}(a) that for a small number of wavelengths, the discretisation of the magnetisation makes little difference to the force characteristic. But as the number of wavelengths increases the number of magnets per wavelength has an increasing effect. As seen most prominently in Figure~\ref{Nwaves}(c), increasing the number of magnets per wavelength $\mupmagperwave$ increases the forces over all values of displacement considered.

\begin{figure*}
\centering
\pregen{%
\subfloat[]{\psfragfig{examples/magspring/fig/halbach-waves-Nwaves-1}}\hfil
\subfloat[]{\psfragfig{examples/magspring/fig/halbach-waves-Nwaves-2}}\hfil
\subfloat[]{\psfragfig{examples/magspring/fig/halbach-waves-Nwaves-4}}
}
\caption{Force vs.\ displacement normalised by the array height $\mupheight$ between two facing linear Halbach arrays with a varying number of magnets per wavelength~$\mupmagperwave$ and a varying number of wavelengths of magnetisation~$\mupNwaves$. The dashed line is the force between two single magnets of equal size to the arrays. Calculated in the file `multipole\_compare.m'.}
\label{Nwaves}
\end{figure*}

Therefore, as a general design guideline, it is only necessary to use a large number of magnets per wavelength if there is at least several wavelengths of magnetisation in total in the array. In the results shown in Figure~\ref{Nwaves}, the ratio in forces between $\mupmagperwave=2$ and $\mupmagperwave=4$ is greater than the ratio in forces between $\mupmagperwave=4$ and $\mupmagperwave=8$; most of the benefit of increasing the number of magnets is realised using four magnets per wavelength of magnetisation (i.e., 90\textdegree\ rotations between successive magnets such as shown in Figure~\ref{multipole-variables}). In cases where there are many more wavelengths of magnetisation again (as shown in Figure~\ref{Nmag-max} later), there is a greater advantage to using $\mupmagperwave=8$ over $\mupmagperwave=4$. Therefore, the greater number of wavelengths of magnetisation, the greater the force improvement in increasing the number of magnets per wavelength.

The use of multipole arrays can have a significant effect on the useful range of the force/displacement characteristic.
As the number of wavelengths increases, the magnetic field of each array becomes stronger but the magnetic field lines exhibit smaller excursions outside the magnet array before returning. Thus, the forces become stronger but over a smaller displacement, and therefore the stiffness of the magnetic spring is increased as well. For some purposes and in some cases, this can be detrimental in that it can increase the resonance frequency of the system, resulting in poorer vibration isolation properties.

\subsection{Constant number of magnets}
\label{Nmag-const}

The results shown previously have in general indicated that improvements to the force characteristic are seen with a greater number of magnets. However, given a minimum magnet thickness that can be fabricated, and hence for a given array length a maximum number of magnets in total, the question arises: is it better to maximise the number of wavelengths $\mupNwaves$ or the number of magnets per wavelength $\mupmagperwave$? Consider an array of the same outer dimensions as the previous example composed of magnets each of length $\mupmaglength=\SI{2}{mm}$ and of cross-sectional area \SI{10x10}{mm}, such that there are \num{50} magnets in the array. The force characteristic for this system, again with $\mupmagperwave\in\{2,4,8\}$, is shown in Figure~\ref{Nmag-max}. In this extreme example with large $\mupNwaves$, the strong region of the field is close to the surfaces of the arrays and there is considerable difference in the curves for each value of $\mupmagperwave$; maximising $\mupmagperwave$ produces stronger results providing there are sufficiently many wavelengths of magnetisation along the length of the array. When $\mupNwaves$ is small (say $\mupNwaves<5$) for a fixed magnet size, these general results do not hold and the design possibilities must be evaluated on a case-by-case basis.

\begin{figure}
\centering
\pregen{\psfragfig{examples/magspring/fig/halbach-max-Nmag}}
\caption{Force characteristic with arrays each composed of fifty magnets of length $\mupmaglength=\SI{2}{mm}$, over a variety of number of magnets per wavelength~$\mupmagperwave$. The dashed line is the force between two homogeneous magnets of length \SI{100}{mm}. Calculated in `multipole\_const\_Nmag.m'.}
\label{Nmag-max}
\end{figure}

\subsection{Non-equal magnet sizes}

While the force characteristic of an eight-magnet wavelength ($\mupmagperwave=8$) array can outperform the four-magnet ($\mupmagperwave=4$) array, the latter can be improved in some cases by adjusting the relative sizes of the magnets in the array.
Consider the four-magnet array shown in Figure~\ref{magratio} in which the horizontally-polarised magnets of length $b$ are smaller than the vertically-polarised magnets of length $a$.
Magnet size ratio $\mupqratio=b/a$ is the measure used here to compare different array configurations, for which $\mupqratio=0$ corresponds to an array composed only of vertically-oriented magnets, and $\mupqratio=1$ corresponds to equally-sized magnets of both horizontal and vertical magnetisations (as considered previously in this paper).

\begin{figure}[t]
\centering
\pregen{\asyfig{PhD/Figures/Multipole/magratio}}
\caption{Schematic of a four-magnet Halbach array with variable magnet sizes. The number of magnets per wavelength $\mupmagperwave=4$ for all arrays of this type unless $b=0$, in which case $\mupmagperwave=2$.}
\label{magratio}
\end{figure}

Figure~\ref{ratios-compare} compares the force characteristic with a variety of magnet size ratios for arrays composed of nine magnets (i.e., two wavelengths of magnetisation with a symmetry magnet), of length $\muplength=\SI{100}{mm}$, and of cross-sectional area \SI{10x10}{mm}.
As expected from the previous results, $\mupqratio=0$ results in smaller forces than for $\mupqratio=1$; however, $\mupqratio=0.5$ results in slightly greater forces again: an increase of 5\% at a displacement of approximately $\mupvdispl=1.3\mupheight$, tapering off as the displacement increases.
(This value of $\mupqratio$ is close to optimum for this system; see Figure~\ref{ratios-forcesum}.)
This result can be justified intuitively with the recognition that there is a stronger vertical force between opposing vertically-polarised magnets than between horizontally-polarised magnets; dedicating a greater proportion of the magnet volume to the vertical magnets yields an increase in the total force.

\begin{figure}
\centering
\pregen{\psfragfig{examples/magspring/fig/ratios-compare}}
\caption{Force characteristic between two modified Halbach arrays of $\mupNwaves=2$ with magnet length ratio $\mupqratio$ between the sizes of vertically- to horizontally-polarised magnets. Calculated in `linear\_quasi\_example.m'.}
\label{ratios-compare}
\end{figure}

However, as the number of wavelengths of magnetisation~$\mupNwaves$ increases, there is a decrease in the improvement offered by reducing the size of the horizontal magnets.
This can be quantified by comparing the integral of force over the displacement range of interest for a variety of magnet length ratios~$\mupqratio$.
In Figure~\ref{ratios-forcesum}, such results are shown (for the same arrays discussed previously) comparing the relative difference of the force--displacement integral as a function of the magnet length ratio, normalised by the integral results for $\mupqratio=1$.
Since the force improvement with adjusting $\mupqratio$ is only significant for low numbers of wavelength of magnetisation, this technique is only suitable for increasing the forces when a small total number of magnets are to be used, perhaps for ease of construction of the magnet array. Otherwise, it is more efficient simply to increase the number of magnets than to change the magnet size ratio.

\begin{figure}
\centering
\pregen{\psfragfig{examples/magspring/fig/ratios-forcesum}}
\caption{Integral of the force--displacement characteristic vs.\ magnet length ratio $\mupqratio$ of two modified Halbach arrays of size \SI{100x10x10}{mm} over a displacement range of \SIrange{10}{20}{mm}, shown with varying number of wavelengths of magnetisation $\mupNwaves$. Calculated in `linear\_quasi\_ratios.m'.}
\label{ratios-forcesum}
\end{figure}

\section{Conclusion}

In conclusion, in optimising the forces between linear Halbach magnet arrays, it has been shown that there is a relationship on the force vs.\ displacement characteristic from both the wavelength of magnetisation and the number of magnets in the array. As the wavelength of magnetisation decreases while keeping the array length constant, the effect of increasing the number of magnets per wavelength increases. In order to achieve significantly larger forces over homogeneous magnetisation, a large number of magnets should be used; a minimum of around $16+1$ magnets with 90\textdegree\ magnetisation rotations or $32+1$ magnets with 45\textdegree\ magnetisation rotations. When only a small number of magnets are used, small improvements to the forces can be achieved by using magnets of smaller volume  which are magnetised parallel to the array length and magnets of larger volume which are polarised in the facing direction.






\section{Forces between arrays}

It has been previously mentioned that the purpose of the arrays is to focus
the flux into the areas where it will be generating spring force. This has the
beneficial side-effect of reducing the forces created between an array and any
ferrous or magnetic object that is nearby in any other direction.
\Figref{halbach-lion} shows three Halbach arrays. They are arranged all in
repulsion, but the top two have their strong sides facing whereas the bottom
two have their weak sides facing. In this static arrangement, the forces
between the strong pair are about 200 times stronger than the weak pair. This
demonstrates the advantages of using Halbach arrays in this manner.

\begin{figure}[htbp]
   \centering
   \grf[height=0.4\textheight]{Figures/Multipole/halbach-lion-fieldstr}
   \caption{Opposing Halbach arrays in the strong and weak fields.}
   \figlabel{halbach-lion}
\end{figure}

As previously mentioned, \cite{cho2001} derived analytic equations for the
flux above several planar arrays; namely, the patchwork and extended linear
designs, and Kim's Halbach superposition. An analytical solution for their own
array is not attempted due to the complexity of the model.

\begin{figure}
   \grf{Figures/Multipole/pa-arb}
   \caption[Arbitrary planar array with cuboid magnets.]{Arbitrary planar
array with cuboid magnets.
$i$ and $j$ are the magnet numbers in the $x$ and $y$ directions.}
   \figlabel{pa-arb}
\end{figure}


\figref{pa-arb} shows an arbitrary planar array, created from a number
of equal-sized cuboid magnets stacked
perpendicular to the $\z$ direction, for which we define the magnetisation,
$\magM$, of \emph{each} magnet as:
\begin{dmath}
  \magM(i,j) = M_x\x + M_y\y + M_z\z
\end{dmath}
where $i$ and $j$ are the magnet numbers in the $\x$ and $\y$ directions,
respectively. This equation is redefined to remove the constant magnetisation
magnitude, $M$, from each term:
\begin{align}
  \magM(i,j) & = M\cdot\hat\magM(i,j) \\
\text{where}\qquad
  \hat\magM(i,j) & = \hat M_x\x + \hat M_y\y + \hat M_z\z
\end{align}
Note that this is the magnetisation of only the bottom array; the
magnetisation of the opposite, repulsive, array can be generated by inverting
the magnetisation in the facing direction: ${\hat M}_{z_2} = -\hat M_z$.

\subsection{Simple arrays}

To begin, the simple arrays are examined and the vertical forces between two
facing arrays solved statically for a range of displacements.

For opposing homogeneous arrays, equivalent to a single magnet, the
magnetisations do not vary:
\begin{dmath}[compact]
\hat M_x = \hat M_y = 0 \condition*{\hat M_z = 1}
\end{dmath}.
For simple `patchwork' magnets as in \figref{pa-ns}, the magnetisation
directions are:
\begin{align}
  \hat M_x & = 0,\\
  \hat M_y & = 0,\\
  \hat M_z & = \Cos{(i\pi)}\Cos{(j\pi)}.
\end{align}
For the case when the linear Halbach array (with
\ang{90} rotations) is extended into the third dimension as in
\figref{pa-x2d}, the magnetisation of the array is:
\begin{align}
  \hat M_x & = \Cos{(\half i \pi)},\\
  \hat M_y & = 0,\\
  \hat M_z & = \Sin{(\half i \pi)}.
\end{align}

The forces between facing pairs of these three arrays is shown in
\figref{pa-simple-forces}. For this graph, and subsequent ones,
$5\times5$ arrays of half-inch rare-earth cube magnets have been used.
The patchwork array did not perform better than the
homogeneous array except in close proximity.

\begin{figure}[htbp]
   \centering
   \grf{Figures/Multipole/pa-simple-forces}
   \caption{Forces between three simple facing arrays.}
   \figlabel{pa-simple-forces}
\end{figure}


\fxfatal{Compare simple forces}

\subsection{Halbach superposition}

The array developed by \citeauthor{kim1997-thesis} is shown in \figref{pa-trumper}.
The magnetisation can be given in two ways. A strict superposition would
simply add the magnetisations of two orthogonal Halbach arrays, yielding:
\begin{align}
    \hat M_x & = -\Sin{(\half i \pi)},\\
    \hat M_y & = -\Sin{(\half j \pi)},\\
    \hat M_z & =  \Cos{(\half i \pi)} + \Cos{(\half j \pi)}.
\end{align}
However, an inspection of the magnetisations shows that the magnets are now
significantly stronger than for the other arrays that have been looked at.
To make the comparison worthwhile, some care must be taken to ensure the
normalised magnetisations of each block
are equal and within the same range ($0\leq\hat M\leq1$) as the other arrays
already shown:
\begin{align}
    \hat M_x & = -\tfrac{1}{\sqrt{2}}\Sin{(\half i \pi)},\\
    \hat M_y & = -\tfrac{1}{\sqrt{2}}\Sin{(\half j \pi)},\\
    \hat M_z & =  \tfrac{1}{\sqrt{2}}\sqrt{\cos^2{(\half i \pi)} + \cos^2{(\half j
\pi)}}.
\end{align}

Only the second case will be considered with equal magnetisations for each magnet.

\subsection{Cho's array}

To look at the array by \citeauthor{cho2001}, a more complex model is
required than the arbitrary array composed of simple block magnets.
For this task, each block magnet may be decomposed into
triangular cross-section pieces, as shown in
\figref{cho-triangles}. The magnetisations can then be expressed in
terms of $\magM_H$, those square blocks containing multipole
magnetisations in the $\x$-$\y$ plane, and $\magM_V$, those in the $\z$
directions, as shown in the figure: (note that $\half(1-(-1)^i) =
0,1,0,1,...$)
\begin{align}
  \begin{split}
  \hat \magM_{i,j} & = \tfrac{1}{4}(1-(-1)^{j})
                \gp{
                    \hat \magM_V (1-(-1)^{i})
                  - \hat \magM_H (1-(-1)^{i+1})
                } \\
          & \quad
            + \tfrac{1}{4}(1-(-1)^{j+1})
                \gp{
                    \hat \magM_H (1-(-1)^{i})
                  - \hat \magM_V (1-(-1)^{i+1})
                }
  \end{split}\\
\intertext{where}
  \hat \magM_V & = (0,0,1), \qquad \text{(for $k=0,\dots,3$)}\\
  \begin{split}
    \hat M_{H_x} & = \Cos{(\half k \pi)},\\
    \hat M_{H_y} & = \Sin{(\half k \pi)},\\
    \hat M_{H_z} & = 0.
  \end{split}
\end{align}

\begin{figure}
   \centering
   \grf{Figures/Multipole/pa-cho-triangles}
   \caption{Cho's array, decomposed into repeating elements.}
   \figlabel{cho-triangles}
\end{figure}

Optimal forces for arrays have been shown by \textcite{marble2008-ietm}. Shapes for
achieving 80\% magnetic field strength while using simpler magnet geometries
are shown.


\section{New work}

Trying to consolidate some earlier work, \figref{ansys} shows are some
ANSYS results for 2D multipole arrays in repulsion over a range of
distances. These show trends as expected: the more magnets used for
discretisation, the greater the forces are, with 45° rotations pretty
close to the asymptote. And of course, the smaller the wavelength of
magnetisation is, the greater the spring stiffness, but which acts
over a smaller range.

\begin{figure}
   \centering
   \grf{Simulations/Magnet_arrays/Halbach_pitch/eps/vary-magnets-3}
   \grf{Simulations/Magnet_arrays/Halbach_pitch/eps/vary-wavelength-3}
   \caption{Old ANSYS plots. First has wavelength as twice the height.
   Second has four magnets per wavelength.}
   \figlabel{ansys}
\end{figure}

For these graphs, 2D analyses were taken for cross sections
$4''\times0.5''$ (a length of eight thicknesses). The coercive force
of the magnets was $900000$, and the magnetic permeability was
$1.1$. The resulting force per metre was multiplied by the thickness
of the array for an overall magnet array dimension of
$4''\times0.5''\times0.5''$.


Taking another look at Paden's paper, I realised I had the Fourier expansion
of the magnetisation all wrong in my MATLAB simulations for such square wave
magnetisation in multipole arrays (the results of which were funny and which
hadn't been used for anything). Fixing this up (see page~112 of my workbook),
the graphs now match up with FEA pretty well.
\begin{dmath*} P_y =
\frac{4B_r}{\pi^2\permVac}\sum^\infty_{n=1,3,5,\dots} \frac{1}{n^2}\exp(-k_n
g)\gp{1-\exp(-k_n d)}^2
\end{dmath*}
The results are shown in
\figref{square-magnetisation-comparison}, but are not compared to a magnetic
nodes solution because at this stage I'm happy enough with this graph.

\begin{figure}
   \centering
   \grf{Simulations/Magnet_arrays/Halbach_pitch/eps/square-magnetisation-comparison}
   \caption{Comparison between analytical and FEA solutions to two repulsive
   eight magnet multipole arrays with half-inch cube magnets alternating
   in magnetisation.}
   \figlabel{square-magnetisation-comparison}
\end{figure}

For eight magnets per wavelength, we get approximately the same
results as for sinusoidally rotating magnetisation. Some old ANSYS
results showing this can be seen in \figref{vw4}. However, these
numbers are quite bigger than results obtained using Backers' formula,
given by \begin{dmath*} P_y = \frac{{B_r}^2}{4\permVac}\exp(-k g)\gp{1-\exp(-k
d)}^2 ; \quad k = \frac{2\pi}{\lambda}.  \end{dmath*}

The reason for this is because Backers' formula uses only sinusoidal
magnetisation in the vertical direction. Campbell, however, derives
some similar equations using rotating
magnetisation~\cite{campbell2002}. However, trying to use this gives
me numbers that are much much too small, so I've obviously done
something terribly wrong there.

\begin{figure}
   \centering
   \grf{Simulations/Magnet_arrays/Halbach_pitch/eps/vary-wavelength-4}
   \caption{Eight magnets per wavelength approximately equals sinusoidal magnetisation.}
   \figlabel{vw4}
\end{figure}

Some notes on Backers' derivation of the forces between two
sinusoidally magnetised plates.  Main features of the work:
\begin{enumerate}
\item infinite plates in \x\ and \y, separated by a gap in \z;
\item magnetisation of the first plate given by
  \begin{dmath}
    \magM_1 = (0, 0, \overline M\Cos{ky}),
  \end{dmath}
  that is, varying sinusoidally with \z, magnetised in the same
  direction as the gap;
\item magnetisation of the second plate is phase shifted, possibly,
  with an offset:
  \begin{dmath}
    \magM_2 = (0, 0, \overline M\Cos{k(y-y_0)}).
  \end{dmath}
\end{enumerate}

To get the forces between them, we start off by looking at the
magnetic potential created due to the first array at any point
$(r_x,r_y,r_z)$. This is given by a volume integral over the infinite
plate, in which the point vector is given by $\vect{r} =
(X-x,Y-y,Z-z)$:
\begin{align}
U(x,y,z) & = \frac{1}{4\pi\permVac}\intd{\limits_{V_1} \frac{\magM_1\bdot\vect{r}}{r^3}}{V_1} \\
         & = \frac{1}{4\pi\permVac}
             \int\limits^0_{-d}
             \int\limits^\infty_{-\infty}
             \int\limits^\infty_{-\infty}
                \frac{(Z-z)\overline M \Cos{ky}}
                     {((X-x)^2+(Y-y)^2+(Z-z)^2)^{3/2}}
             \,\dee X\dee Y\dee Z                      \\
         & = \frac{\overline M \Cos{ky}}{4\pi\permVac}
             \iiint
                \frac{(Z-z)}
                     {\gp{(X-x)^2+(Y-y)^2+(Z-z)^2}^{3/2}}
             \,\dee X\dee Y\dee Z
\end{align}
Here's where Backers comes in with his solution:
\begin{dmath}
U(x,y,z) = \frac{\overline M\Cos{kx}}{2k\permVac}\gp{\e^{-ky}}\gp{1-\e^{-kd}}
\end{dmath}
from which we eventually calculate the forces between the plates with
the following steps:
\begin{align}
\magH & = \nabla U \\
E  & = - \int\limits_{V_2}\magM_2\bdot\magH\,\dee{V_2} \\
\vect F  & = -\nabla E
\end{align}

The next step for me is to perform these steps using rotating
magnetisation, that is
\begin{dmath}
  \magM_1 = (0, \overline M\Sin{ky}, \overline M\Cos{ky}),
\end{dmath}
and similarly for $\magM_2$. We end up with
\begin{align}
\begin{split}
U(x,y,z)={}& \frac{\overline M \Cos{ky}}{4\pi\permVac}
             \int\limits^0_{-d}
             \int\limits^\infty_{-\infty}
             \int\limits^\infty_{-\infty}
                \frac{(Z-z)}
                     {\gp{(X-x)^2+(Y-y)^2+(Z-z)^2}^{3/2}}
             \,\dee X\dee Y\dee Z                                  \\
         & + \frac{\overline M \Sin{ky}}{4\pi\permVac}
             \int\limits^0_{-d}
             \int\limits^\infty_{-\infty}
             \int\limits^\infty_{-\infty}
                \frac{(Y-y)}
                     {\gp{(X-x)^2+(Y-y)^2+(Z-z)^2}^{3/2}}
             \,\dee X\dee Y\dee Z,
\end{split}
\end{align}
whose two terms are not equivalent due to different limits of
integration. So here we are.



I've some analyses performed with my (now efficiently and correctly
working) implementation of Charpentier \etal's technique of the
forces between two multipole arrays; similarly to the previous such
analyses, the wavelength is varied
(\figref{french-array-zforces-vary-wavelength}) and number of
magnets used per wavelength is varied
(\figref{french-array-zforces-vary-nummagnets}) for two fixed
multipole arrays at varying distances. Only forces in the
\z-direction are considered at this point.

\begin{figure}
\begin{wide}
  \def\figpath{\phdpath Simulations/Magnet_arrays/French_array/eps-20051109/}
  \subfloat[Two magnets per wavelength]
    {\includegraphics{\figpath french-array-zforces-vary-wavelength-nummagnets=2}}
  \hfill
  \subfloat[Four magnets per wavelength]
    {\includegraphics{\figpath french-array-zforces-vary-wavelength-nummagnets=4}}
  \\
  \subfloat[Eight magnets per wavelength]
    {\includegraphics{\figpath french-array-zforces-vary-wavelength-nummagnets=8}}
  \hfill
  \subfloat[Sixteen magnets per wavelength]
    {\includegraphics{\figpath french-array-zforces-vary-wavelength-nummagnets=16}}
\end{wide}
  \caption{\z-forces between two multipole arrays with
           varying wavelength of magnetisation.}
  \figlabel{french-array-zforces-vary-wavelength}
\end{figure}

\begin{figure}
\begin{wide}
  \def\figpath{\phdpath Simulations/Magnet_arrays/French_array/eps-20051109/}
  \subfloat[Normalised wavelength of one]
    {\includegraphics{\figpath french-array-zforces-vary-nummagnets-wavelength=1}}
  \hfill
  \subfloat[Normalised wavelength of two]
    {\includegraphics{\figpath french-array-zforces-vary-nummagnets-wavelength=2}}
  \\
  \subfloat[Normalised wavelength of four]
    {\includegraphics{\figpath french-array-zforces-vary-nummagnets-wavelength=4}}
  \hfill
  \subfloat[Normalised wavelength of eight]
    {\includegraphics{\figpath french-array-zforces-vary-nummagnets-wavelength=8}}
\end{wide}
  \caption{\z-forces between two multipole arrays with
           varying number of magnets per wavelength.}
  \figlabel{french-array-zforces-vary-nummagnets}
\end{figure}

\begin{figure}
   \centering
   \grf{Figures/Multipole/magnets-per-wavelength}
   \caption{Increasing approximation of sinusoidal magnetisation.}
   \figlabel{magnets-per-wavelength}
\end{figure}

\subsection{Experimental measurements}

Mike Devine at `Dexter Magnetic Technologies, Inc.' kindly sent us a
nine-pole Halbach array for testing purposes.  The properties of the
array are summarised in \tabref{multipole-sample-properties}.  The
multipole array is composed of eights magnets with \ang{45}
magnetisation rotations (a single wavelength of magnetisation) plus
one magnet for symmetry (\ie, the first and last magnet both have
$\ang{+90}$ magnetisations).

The magnet dimensions are $\SI{12.7}{mm} \times \SI{12.7}{mm} \times
\SI{21.3}{mm}$, with the square faces in the plane of the rotation of
magnetisation. They are set on an aluminium plate, which is \SI{1.6}{mm}
thick, that is two magnet widths wider than the array itself.

\begin{table}
  \caption{Multipole array properties.}
  \tablabel{multipole-sample-properties}
  \begin{tabular}{@{} ll @{}}
    \toprule
    Number of magnets      & Nine             \\
    Magnetisation rotation & \ang{45}         \\
    Nominal energy product & \SI{382}{kJ/m^3} \\
    Intrinsic coercivity   & \SI{875}{kA/m}   \\
    Array height           & \SI{12.7}{mm}    \\
    Array width            & \SI{114.3}{mm}
                             ($9\times\SI{12.7}{mm}$) \\
    Array depth            & \SI{21.3}{mm}    \\
    Former depth           & \SI{1.6}{mm}     \\
    Magnet coating         & Everlube 9800    \\
    \bottomrule
  \end{tabular}
\end{table}

The remanence magnetisation is calculated from the nominal energy
product of the magnets \cite{campbell1994}. The nominal energy product
$\BHmax$ is related to the saturation magnetisation by
\begin{dmath}
\BHmax = \permVac\gp{\half \Msat}^2,
\end{dmath}
which can be used to calculate the remanence with the relation
$\remanence=\permVac\Msat$:
\begin{dmath}
\remanence=\sqrt{4\permVac\BHmax}=\SI{1.39}{T}.
\end{dmath}


\section{Future work}

The code presented here currently only contains algorithms for calculating forces and stiffnesses between cuboid magnets without rotation. \textcite{charpentier1999-ietm-sep} present expressions for two components of the force between cuboid magnets with rotation around one axis (also see their related publications around the same time), but there is no general solution known without using semi-numerical methods \parencite{charpentier2001}.

\textcite{agashe2008-applphys} and \textcite{nagaraj1988} have also calculated forces between cuboid magnets as well as between cylindrical magnets, which latter have more complex solutions due to the presence of elliptic integrals. \textcite{janssen2009-ietm} have derived the analytical forces between pyramidal-frustrum shaped magnets, which have not quite yet been published at time of writing. \textcite{lee2006-mx} and \textcite{cho2001} present different planar arrays using block magnets with trapezoidal and triangular cross-sections, and \textcite{yan2006-iemx} calculate torque for spherical multipole arrays with `dihedral cone'-shaped magnets. And there are a wide variety of cylindrical multipole arrays in use for bearing and brushless motor applications \parencite{zhu2001-ipep}.


